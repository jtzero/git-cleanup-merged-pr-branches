#!/usr/bin/env bash
#
#

set -Eeuo pipefail

if [ -z "${BASH_SOURCE[0]:-}" ]; then
  # zsh
  GCMPR_BIN_DIR="${0:A:h}"
  # shellcheck disable=SC2034
  IS_ZSH=1
else
  if ! command -v realpath >/dev/null 2>&1; then
    exit 1
  fi
  GCMPR_BIN_DIR="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"
  # shellcheck disable=SC2034
  IS_BASH=1
fi

GCMPR_DIR="$(dirname "${GCMPR_BIN_DIR}")"
GCMPR_LIB_DIR="${GCMPR_DIR}/lib"

if [ "${GCMPR_DEBUG:-}" = 'true' ]; then
  set -x
fi

COMMAND="${1:-}"

. "${GCMPR_LIB_DIR}/git-cleanup-merged-prs" "${@}"

config_exclusions="$(excluded_by_config)"

case "${COMMAND}" in
help|--help|?|--?)
  help true
  ;;
"")
  run "1" "${config_exclusions}" "${GCMPR_AUTO_APPLY:-false}" "${GCMPR_SKIP_CLEANUP_MERGED_PRS:-false}" "${GCMPR_VERBOSE:-false}"
  ;;
*)
  echoerr "unknown command"
  echoerr "$(help)"
  exit 1
  ;;
esac

if [ "${GCMPR_DEBUG:-}" = 'true' ]; then
  set +x
fi
